<template>
  <div class="mail-container">
    <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
    <div class="header">
      <div class="header-left header-left-icons">
        <span class="header-icon header-icon--bl">
          <svg width="1.5em" height="1.5em" viewBox="0 0 32 32" fill="none">
            <rect x="4" y="8" width="24" height="16" rx="4" fill="#2196f3"/>
            <path d="M4 8l12 10l12-10" stroke="#fff" stroke-width="2" fill="none"/>
          </svg>
        </span>
        <span class="header-title">å†…éƒ¨é‚®ä»¶</span>
        <span class="header-icon header-icon--tr">
          <svg width="1.5em" height="1.5em" viewBox="0 0 32 32" fill="none">
            <rect x="4" y="8" width="24" height="16" rx="4" fill="#ffa726"/>
            <path d="M4 8l12 10l12-10" stroke="#fff" stroke-width="2" fill="none"/>
          </svg>
        </span>
      </div>
      <div class="header-right">
        <div class="header-search">
          <span class="search-icon">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
              <circle cx="7" cy="7" r="6" stroke="#bdbdbd" stroke-width="1.5" fill="none"/>
              <path d="M12 12l-2.5-2.5" stroke="#bdbdbd" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
          </span>
          <input class="search-input" type="text" placeholder="æœç´¢" />
        </div>
      </div>
    </div>
    
    <!-- ä¸»ä½“å†…å®¹åŒº -->
    <div class="content-wrapper">
      <!-- å·¦ä¾§è¾¹æ  -->
      <div class="sidebar">
        <!-- é¡¶éƒ¨æŒ‰é’®åŒºåŸŸ -->
        <div class="sidebar-top">
          <button class="compose-btn active">
            <span class="icon">
              <svg width="20" height="20" viewBox="0 0 20 20">
                <path fill="#f5a623" d="M16.5,2.9c-0.2-0.2-0.5-0.3-0.8-0.3c-0.3,0-0.6,0.1-0.8,0.3L4.2,13.6c-0.4,0.4-0.4,1.1,0,1.5c0.4,0.4,1.1,0.4,1.5,0L16.5,4.4c0.4-0.4,0.4-1.1,0-1.5C16.5,2.9,16.5,2.9,16.5,2.9z M13.1,8.9l-1.5-1.5L15,4l1.5,1.5L13.1,8.9z M4.9,15.7l-1.5,1.5c-0.2,0.2-0.5,0.3-0.8,0.3s-0.6-0.1-0.8-0.3c-0.4-0.4-0.4-1.1,0-1.5l1.5-1.5L4.9,15.7z"/>
              </svg>
            </span>
            å†™ä¿¡
          </button>
          <button class="inbox-btn">
            <span class="icon">ğŸ“¥</span>
            æ”¶ä»¶ç®±
          </button>
        </div>

        <!-- æ–‡ä»¶å¤¹åˆ—è¡¨ -->
        <div class="folder-list">
          <div class="folder-item">
            <span class="folder-icon">
              <!-- ä¿¡ç®±SVG -->
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><rect x="2" y="6" width="16" height="12" rx="3" stroke="#ff9800" stroke-width="1.5" fill="none"/><path d="M2 6l8 6 8-6" stroke="#ff9800" stroke-width="1.5" fill="none"/></svg>
            </span>
            <span class="folder-name">æ”¶ä»¶ç®±</span><span class="folder-badge">1</span>
          </div>
          <div class="folder-item">
            <span class="folder-icon">
              <!-- æ˜Ÿæ ‡SVG -->
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><polygon points="10,2 12,7.5 18,7.5 13,11.5 15,17 10,13.5 5,17 7,11.5 2,7.5 8,7.5" stroke="#ff9800" stroke-width="1.5" fill="none"/></svg>
            </span>
            <span class="folder-name">æ˜Ÿæ ‡é‚®ä»¶</span>
          </div>
          <div class="folder-item">
            <span class="folder-icon">
              <!-- çº¸é£æœºSVG -->
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><polygon points="2,18 18,10 2,2 5,10 2,18" stroke="#ff9800" stroke-width="1.5" fill="none"/></svg>
            </span>
            <span class="folder-name">å·²å‘é€</span>
          </div>
          <div class="folder-item">
            <span class="folder-icon">
              <!-- æ–‡ä»¶å¤¹SVG -->
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><rect x="2" y="6" width="16" height="10" rx="2" stroke="#ff9800" stroke-width="1.5" fill="none"/><path d="M2 6l6-4 4 4h6" stroke="#ff9800" stroke-width="1.5" fill="none"/></svg>
            </span>
            <span class="folder-name">è‰ç¨¿ç®±</span><span class="folder-badge">4</span>
          </div>
          <div class="folder-item">
            <span class="folder-icon">
              <!-- åƒåœ¾æ¡¶SVG -->
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><rect x="5" y="7" width="10" height="9" rx="2" stroke="#ff9800" stroke-width="1.5" fill="none"/><path d="M3 7h14" stroke="#ff9800" stroke-width="1.5" fill="none"/><path d="M8 10v3" stroke="#ff9800" stroke-width="1.2"/><path d="M12 10v3" stroke="#ff9800" stroke-width="1.2"/></svg>
            </span>
            <span class="folder-name">å·²åˆ é™¤</span>
          </div>
          <div class="folder-item">
            <span class="folder-icon">
              <!-- åƒåœ¾ç®±SVG -->
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><rect x="2" y="6" width="16" height="12" rx="3" stroke="#ff9800" stroke-width="1.5" fill="none"/><rect x="8" y="10" width="4" height="4" rx="1" stroke="#ff9800" stroke-width="1.2" fill="none"/></svg>
            </span>
            <span class="folder-name">åƒåœ¾ç®±</span><span class="folder-badge">8</span>
          </div>
          <div class="folder-item">
            <span class="folder-icon">
              <!-- æ–‡ä»¶å¤¹SVG -->
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><polygon points="2,18 18,10 2,2 5,10 2,18" stroke="#ff9800" stroke-width="1.5" fill="none"/></svg>
            </span>
            <span class="folder-name">æˆ‘çš„æ–‡ä»¶å¤¹</span>
          </div>
        </div>
      </div>
      
      <!-- ä¸»å†…å®¹åŒºåŸŸ -->
      <div class="main-content">
        <!-- å·¥å…·æ  -->
        <div class="toolbar">
          <div class="toolbar-left">
            <div class="tool-btn primary" @click="sendMail">
              <el-icon><Position /></el-icon>
              <span>å‘é€</span>
            </div>
            <div class="tool-btn">
              <el-icon><View /></el-icon>
              <span>é¢„è§ˆ</span>
            </div>
            <div class="tool-btn">
              <el-icon><Files /></el-icon>
              <span>é™„ä»¶</span>
            </div>

            <div class="tool-btn">
              <el-icon><Files /></el-icon>
              <span>è¶…å¤§é™„ä»¶</span>
            </div>
            <el-dropdown trigger="click">
              <div class="tool-btn">
                <el-icon><Setting /></el-icon>
                <span>å‘ä¿¡è®¾ç½®</span>
                <el-icon class="el-icon--right"><ArrowDown /></el-icon>
              </div>
              <template #dropdown>
                <el-dropdown-menu>
                  <el-dropdown-item>å®šæ—¶å‘é€</el-dropdown-item>
                  <el-dropdown-item>è¯·æ±‚å·²è¯»å›æ‰§</el-dropdown-item>
                  <el-dropdown-item>è®¾ç½®ä¼˜å…ˆçº§</el-dropdown-item>
                </el-dropdown-menu>
              </template>
            </el-dropdown>
          </div>
          <div class="toolbar-right">
            <span class="time" style="min-width: 180px; white-space: nowrap;">å·²äº{{ currentTime }}ä¿å­˜è‡³è‰ç¨¿</span>
            <div class="tool-btn" @click="closeEditor">
              <el-icon><Close /></el-icon>
            </div>
          </div>
        </div>
        
        <!-- é‚®ä»¶è¡¨å•åŒºåŸŸ -->
        <div class="mail-form">
          <!-- æ”¶ä»¶äººè¡Œ -->
          <div class="form-row">
            <div class="form-label">æ”¶ä»¶äººï¼š</div>
            <div class="form-field">
              <el-select
                v-model="mailForm.recipients"
                multiple
                filterable
                remote
                reserve-keyword
                placeholder="è¯·è¾“å…¥æ”¶ä»¶äºº"
                :remote-method="searchUsers"
                :loading="loading"
                class="recipient-select"
              >
                <el-option
                  v-for="item in userOptions"
                  :key="item.value"
                  :label="item.label"
                  :value="item.value"
                >
                  <div class="user-option">
                    <el-avatar :size="24" :src="item.avatar">{{ item.label.substring(0, 1) }}</el-avatar>
                    <span>{{ item.label }}</span>
                  </div>
                </el-option>
              </el-select>
            </div>
            <div class="form-actions">
              <span class="action-link" @click="showCc = !showCc">æŠ„é€</span>
              <span class="action-link" @click="showBcc = !showBcc">å¯†é€</span>
              <span>|</span>
              <span class="action-link">åˆ†åˆ«å‘é€</span>
            </div>
          </div>
          
          <!-- æŠ„é€è¡Œ -->
          <div class="form-row" v-if="showCc">
            <div class="form-label">æŠ„é€ï¼š</div>
            <div class="form-field">
              <el-select
                v-model="mailForm.cc"
                multiple
                filterable
                remote
                reserve-keyword
                placeholder="è¯·è¾“å…¥æŠ„é€äºº"
                :remote-method="searchUsers"
                :loading="loading"
                class="recipient-select"
              >
                <el-option
                  v-for="item in userOptions"
                  :key="item.value"
                  :label="item.label"
                  :value="item.value"
                >
                  <div class="user-option">
                    <el-avatar :size="24" :src="item.avatar">{{ item.label.substring(0, 1) }}</el-avatar>
                    <span>{{ item.label }}</span>
                  </div>
                </el-option>
              </el-select>
            </div>
          </div>
          
          <!-- å¯†é€è¡Œ -->
          <div class="form-row" v-if="showBcc">
            <div class="form-label">å¯†é€ï¼š</div>
            <div class="form-field">
              <el-select
                v-model="mailForm.bcc"
                multiple
                filterable
                remote
                reserve-keyword
                placeholder="è¯·è¾“å…¥å¯†é€äºº"
                :remote-method="searchUsers"
                :loading="loading"
                class="recipient-select"
              >
                <el-option
                  v-for="item in userOptions"
                  :key="item.value"
                  :label="item.label"
                  :value="item.value"
                >
                  <div class="user-option">
                    <el-avatar :size="24" :src="item.avatar">{{ item.label.substring(0, 1) }}</el-avatar>
                    <span>{{ item.label }}</span>
                  </div>
                </el-option>
              </el-select>
            </div>
          </div>
          
          <!-- ä¸»é¢˜è¡Œ -->
          <div class="form-row">
            <div class="form-label">ä¸»é¢˜ï¼š</div>
            <div class="form-field">
              <el-input placeholder="è¯·è¾“å…¥é‚®ä»¶ä¸»é¢˜" v-model="mailForm.subject" />
            </div>
          </div>
        </div>
        
        <!-- ç¼–è¾‘å™¨å·¥å…·æ  -->
        <div class="editor-toolbar" style="background-color: #f5faff; border-bottom: 1px solid #e0e0e0; padding: 10px 20px;">
          <div class="toolbar-group">
            <div class="tool-btn">
              <el-icon><ArrowLeftBold /></el-icon>
            </div>
            <div class="tool-btn">
              <el-icon><ArrowRightBold /></el-icon>
            </div>
            <div class="tool-btn">
              <el-icon><PictureFilled /></el-icon>
            </div>
            <div class="tool-btn">
              <el-icon><Link /></el-icon>
            </div>
            <div class="tool-btn">
              <el-icon><Document /></el-icon>
            </div>
            <div class="tool-btn">
              <el-icon><Clock /></el-icon>
            </div>
            <div class="tool-btn">
              <el-icon><Avatar /></el-icon>
            </div>
          </div>
          
          <div class="toolbar-group">
            <div class="tool-select">
              <span>é»˜è®¤å­—ä½“</span>
              <el-icon><ArrowDown /></el-icon>
            </div>
            
            <div class="tool-select">
              <span>å­—å·</span>
              <el-icon><ArrowDown /></el-icon>
            </div>
          </div>
          
          <div class="toolbar-group">
            <div class="tool-btn" @click="execFormatCommand('bold')" title="åŠ ç²—">
              <font-awesome-icon :icon="['fas', 'bold']" />
            </div>
            <div class="tool-btn" @click="execFormatCommand('italic')" title="æ–œä½“">
              <font-awesome-icon :icon="['fas', 'italic']" />
            </div>
            <div class="tool-btn" @click="execFormatCommand('underline')" title="ä¸‹åˆ’çº¿">
              <font-awesome-icon :icon="['fas', 'underline']" />
            </div>
            <div class="tool-btn">
              <el-icon><Delete /></el-icon>
            </div>
            <div class="tool-btn">
              <el-icon><Edit /></el-icon>
            </div>
          </div>
          
          <div class="toolbar-group">
            <div class="tool-btn" @click="execFormatCommand('insertUnorderedList')" title="æ— åºåˆ—è¡¨">
              <font-awesome-icon :icon="['fas', 'list-ul']" />
            </div>
            <div class="tool-btn" @click="execFormatCommand('insertOrderedList')" title="æœ‰åºåˆ—è¡¨">
              <font-awesome-icon :icon="['fas', 'list-ol']" />
            </div>
            <div class="tool-btn" @click="execFormatCommand('justifyLeft')" title="å·¦å¯¹é½">
              <font-awesome-icon :icon="['fas', 'align-left']" />
            </div>
            <div class="tool-btn" @click="execFormatCommand('justifyCenter')" title="å±…ä¸­å¯¹é½">
              <font-awesome-icon :icon="['fas', 'align-center']" />
            </div>
            <div class="tool-btn" @click="execFormatCommand('justifyRight')" title="å³å¯¹é½">
              <font-awesome-icon :icon="['fas', 'align-right']" />
            </div>
            <div class="tool-btn" @click="execFormatCommand('justifyFull')" title="ä¸¤ç«¯å¯¹é½">
              <font-awesome-icon :icon="['fas', 'align-justify']" />
            </div>
          </div>
        </div>
        
        <!-- ç¼–è¾‘å™¨å†…å®¹åŒº -->
        <div class="editor-content" contenteditable="true" @input="onEditorInput" style="flex: 1; padding: 20px; background-color: #ffffff; min-height: 300px; outline: none; border-radius: 0 0 4px 4px;">
          <p>è¯·è¾“å…¥æ­£æ–‡</p>
        </div>
        
        <!-- å‘ä»¶äººä¿¡æ¯ -->
        <div class="sender-info">
          <span>å‘ä»¶äººï¼š</span>
          <span>{{ currentUser }}</span>
        </div>
      </div>
      
      <!-- å³ä¾§è”ç³»äººåˆ—è¡¨ -->
      <div class="contact-list" style="width: 220px; background-color: #ffffff; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-left: 8px; overflow: hidden;">
        <div class="contact-header" style="padding: 12px 15px; font-size: 16px; font-weight: bold; border-bottom: 1px solid #e6e6e6; background-color: #f5faff;">
          <span>è”ç³»äºº</span>
        </div>
        
        <div class="contact-search" style="padding: 10px; border-bottom: 1px solid #e6e6e6;">
          <div class="header-search" style="width: 100%; height: 32px;">
            <span class="search-icon">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <circle cx="7" cy="7" r="6" stroke="#bdbdbd" stroke-width="1.5" fill="none"/>
                <path d="M12 12l-2.5-2.5" stroke="#bdbdbd" stroke-width="1.5" stroke-linecap="round"/>
              </svg>
            </span>
            <input class="search-input" type="text" placeholder="æœç´¢è”ç³»äºº" v-model="contactSearch" />
          </div>
        </div>
        
        <div class="contact-groups" style="flex: 1; overflow-y: auto; padding: 10px;">
          <div 
            v-for="(group, index) in contactGroups" 
            :key="index"
            class="contact-group"
            style="margin-bottom: 10px;"
          >
            <div 
              class="folder-item" 
              @click="toggleGroupExpand(index)"
              style="display: flex; align-items: center; padding: 6px 4px; cursor: pointer; font-size: 12px; color: #333; border-radius: 2px; margin-bottom: 2px;"
            >
              <span class="folder-icon">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                  <path d="M4 6l4 4 4-4" stroke="#ff9800" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" :transform="!group.expanded ? 'rotate(-90 8 8)' : ''"/>
                </svg>
              </span>
              <span class="folder-name">{{ group.name }}</span>
              <span class="folder-badge">{{ group.contacts.length }}</span>
            </div>
            
            <div class="group-contacts" v-if="group.expanded">
              <div 
                v-for="contact in filteredContacts(group.contacts)" 
                :key="contact.id"
                class="contact-item"
                @click="addRecipient(contact)"
              >
                <el-avatar :size="24">{{ contact.name.substring(0, 1) }}</el-avatar>
                <div class="contact-info" style="flex: 1; min-width: 0; overflow: hidden;">
                  <div class="contact-name" style="font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{{ contact.name }}</div>
                  <div class="contact-email" style="font-size: 11px; color: #666; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{{ contact.email }}</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, onMounted } from 'vue'
import { useRouter } from 'vue-router'
import { ElMessage, ElMessageBox } from 'element-plus'
import { useUserStore } from '@/store/modules/user'
import '@/views/mail/mail.css'

// å¯¼å…¥Font Awesomeç»„ä»¶å’Œå›¾æ ‡
import { FontAwesomeIcon } from '@fortawesome/vue-fontawesome'
import { library } from '@fortawesome/fontawesome-svg-core'
import {
  faAlignLeft,
  faAlignCenter,
  faAlignRight,
  faAlignJustify,
  faListUl,
  faListOl,
  faBold,
  faItalic,
  faUnderline
} from '@fortawesome/free-solid-svg-icons'

// æ·»åŠ å›¾æ ‡åˆ°åº“
library.add(
  faAlignLeft,
  faAlignCenter,
  faAlignRight,
  faAlignJustify,
  faListUl,
  faListOl,
  faBold,
  faItalic,
  faUnderline
)
import {
  Document,
  Edit,
  Star,
  Position,
  Files,
  Delete,
  Folder,
  Search,
  Plus,
  ArrowDown,
  ArrowRight,
  Setting,
  Back,
  Paperclip,
  Clock,
  CaretTop,
  CaretBottom,
  Avatar,
  PictureFilled,
  Link,
  ArrowRightBold,
  ArrowLeftBold,
  View,
  Close
} from '@element-plus/icons-vue'

// å¯¼å…¥mockæ•°æ®
import { 
  sidebarItems as mockSidebarItems, 
  userOptions as mockUserOptions, 
  contactGroups as mockContactGroups,
  sendingOptions as mockSendingOptions,
  searchUsers
} from './mock/write.js'

const router = useRouter()

// è¡¨å•æ•°æ®
const mailForm = ref({
  recipients: [],
  cc: [],
  bcc: [],
  subject: '',
  content: ''
})

// UIçŠ¶æ€
const showCc = ref(false)
const showBcc = ref(false)
const contactSearch = ref('')
const loading = ref(false)

// ä½¿ç”¨mockæ•°æ®
const sidebarItems = ref(mockSidebarItems)
const userOptions = ref(mockUserOptions)
const contactGroups = ref(mockContactGroups.map(group => ({ ...group, expanded: true })))
const sendingOptions = mockSendingOptions

// å½“å‰ç”¨æˆ·ä¿¡æ¯
const userStore = useUserStore();
const currentUser = computed(() => userStore.getUser.nickname || 'æœªç™»å½•ç”¨æˆ·');

// å½“å‰æ—¶é—´
const currentTime = computed(() => {
  const now = new Date()
  const hours = now.getHours().toString().padStart(2, '0')
  const minutes = now.getMinutes().toString().padStart(2, '0')
  return `${hours}:${minutes}`
})

// èœå•å›¾æ ‡æ˜ å°„
const getMenuIcon = (iconName) => {
  const iconMap = {
    'Edit': ['fas', 'pen-to-square'],
    'Document': ['fas', 'envelope'],
    'Star': ['fas', 'star'],
    'Position': ['fas', 'paper-plane'],
    'Files': ['fas', 'file'],
    'Delete': ['fas', 'trash'],
    'Folder': ['fas', 'folder'],
    'Search': ['fas', 'search'],
    'Plus': ['fas', 'plus'],
    'Folder-Delete': ['fas', 'dumpster']
  }
  
  return iconMap[iconName] || ['fas', 'envelope'] // é»˜è®¤å›¾æ ‡
}

// æ¨¡æ‹Ÿæœç´¢ç”¨æˆ·
const remoteSearch = (query) => {
  if (query) {
    loading.value = true
    searchUsers(query).then(results => {
      userOptions.value = results
      loading.value = false
    })
  } else {
    userOptions.value = mockUserOptions
  }
}

// åˆ‡æ¢è”ç³»äººåˆ—è¡¨æ˜¾ç¤º - å·²ç§»é™¤æŠ˜å åŠŸèƒ½
const toggleContactList = () => {
  // ä¸å†éœ€è¦
}

// åˆ‡æ¢åˆ†ç»„å±•å¼€çŠ¶æ€
const toggleGroupExpand = (index) => {
  contactGroups.value[index].expanded = !contactGroups.value[index].expanded
}

// è¿‡æ»¤è”ç³»äºº
const filteredContacts = (contacts) => {
  if (!contactSearch.value) return contacts
  return contacts.filter(contact => 
    contact.name.toLowerCase().includes(contactSearch.value.toLowerCase()) || 
    contact.email.toLowerCase().includes(contactSearch.value.toLowerCase())
  )
}

// æ·»åŠ æ”¶ä»¶äºº
const addRecipient = (contact) => {
  const recipient = {
    value: contact.id,
    label: `${contact.name} <${contact.email}>`
  }
  if (!mailForm.value.recipients.some(item => item.value === recipient.value)) {
    mailForm.value.recipients.push(recipient)
  }
}

// å¤„ç†ç¼–è¾‘å™¨è¾“å…¥
const handleEditorInput = (e) => {
  mailForm.value.content = e.target.innerHTML
}

// å‘é€é‚®ä»¶
const sendMail = () => {
  if (!mailForm.value.recipients.length) {
    ElMessage.warning('è¯·é€‰æ‹©æ”¶ä»¶äºº')
    return
  }
  if (!mailForm.value.subject) {
    ElMessageBox.confirm('æ˜¯å¦ç¡®è®¤å‘é€æ— ä¸»é¢˜é‚®ä»¶ï¼Ÿ', 'æç¤º', {
      confirmButtonText: 'ç¡®å®š',
      cancelButtonText: 'å–æ¶ˆ',
      type: 'warning'
    }).then(() => {
      doSendMail()
    }).catch(() => {})
    return
  }
  doSendMail()
}

// æ‰§è¡Œå‘é€é‚®ä»¶
const doSendMail = () => {
  loading.value = true
  setTimeout(() => {
    loading.value = false
    ElMessage.success('é‚®ä»¶å‘é€æˆåŠŸ')
    router.push('/mail/inbox')
  }, 1000)
}

// å…³é—­ç¼–è¾‘å™¨
const closeEditor = () => {
  ElMessageBox.confirm('æ˜¯å¦ä¿å­˜è‰ç¨¿ï¼Ÿ', 'æç¤º', {
    confirmButtonText: 'ä¿å­˜',
    cancelButtonText: 'ä¸ä¿å­˜',
    distinguishCancelAndClose: true,
    closeOnClickModal: false
  }).then(() => {
    // ä¿å­˜è‰ç¨¿
    console.log('ä¿å­˜è‰ç¨¿:', mailForm.value)
    ElMessage.success('è‰ç¨¿ä¿å­˜æˆåŠŸ')
    router.push('/mail/inbox')
  }).catch((action) => {
    if (action === 'cancel') {
      // ä¸ä¿å­˜ï¼Œç›´æ¥è¿”å›
      router.push('/mail/inbox')
    }
  })
}

// ä¸Šä¼ é™„ä»¶
const uploadAttachment = () => {
  console.log('ä¸Šä¼ é™„ä»¶')
}

// æ’å…¥å›¾ç‰‡
const insertImage = () => {
  console.log('æ’å…¥å›¾ç‰‡')
}

// æ’å…¥è¡¨æ ¼
const insertTable = () => {
  console.log('æ’å…¥è¡¨æ ¼')
}

// æ–‡æœ¬æ ¼å¼åŒ–å‘½ä»¤
const execFormatCommand = (command) => {
  document.execCommand(command, false, null)
}

onMounted(() => {
  // åˆå§‹åŒ–ç¼–è¾‘å™¨
})
</script>



<style scoped>
/* æ•´ä½“å¸ƒå±€ */
.mail-container {
  display: flex;
  flex-direction: column;
  height: 100vh;
  background-color: #f5f7fa;
  color: #303133;
  overflow: hidden; /* é˜²æ­¢æº¢å‡ºå‡ºç°æ»šåŠ¨æ¡ */
}

/* ä½¿ç”¨:deepé€‰æ‹©å™¨æ¥æ­£ç¡®åº”ç”¨æŒ‰é’®æ ·å¼ */
.sidebar :deep(.sidebar-top) {
  margin: 0 -8px 20px -8px;
  background: #fff;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.04);
  padding: 12px 8px 8px 8px;
  border-bottom: 2px solid #e3f2fd;
}

.sidebar :deep(.compose-btn), .sidebar :deep(.inbox-btn) {
  width: 100%;
  padding: 10px 8px;
  margin-bottom: 6px;
  border: 1px solid #e0e0e0;
  border-radius: 6px;
  background-color: #ffffff;
  cursor: pointer;
  font-size: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  color: #333;
}

.sidebar :deep(.compose-btn.active) {
  background-color: #4285f4;
  color: white;
  border-color: #4285f4;
}

.sidebar :deep(.compose-btn:hover), .sidebar :deep(.inbox-btn:hover) {
  background-color: #f0f0f0;
}

.sidebar :deep(.compose-btn.active:hover) {
  background-color: #3367d6;
}

.folder-list {
  flex: 1;
  background: #fff;
  margin: 0 -8px -8px -8px;
  padding: 8px;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.04);
}

.folder-item {
  display: flex;
  align-items: center;
  padding: 8px 6px;
  cursor: pointer;
  font-size: 14px;
  color: #333;
  border-radius: 12px;
  margin-bottom: 3px;
}

.folder-icon {
  margin-right: 8px;
  font-size: 14px;
  display: flex;
  align-items: center;
}

.folder-name {
  flex: 1;
  font-size: 13px;
}

.folder-badge {
  background-color: #e0e0e0;
  border-radius: 10px;
  padding: 0 6px;
  font-size: 11px;
  color: #666;
  margin-left: 4px;
}

/* é¡¶éƒ¨æ ‡é¢˜æ  */
.mail-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 20px;
  height: 50px;
  border-bottom: 1px solid #e6e6e6;
  background-color: #fff;
  box-shadow: 0 1px 4px rgba(0,0,0,0.05);
}

.mail-logo {
  display: flex;
  align-items: center;
}

.logo-icon {
  width: 30px;
  height: 30px;
  background-color: #4e73df;
  color: white;
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 8px;
}

.logo-text {
  font-size: 18px;
  font-weight: bold;
  color: #4e73df;
}

.search-box {
  width: 240px;
}

/* ä¸»ä½“å¸ƒå±€ */
.content-wrapper {
  display: flex;
  flex: 1;
  background-color: #e3f2fd;
  padding: 0 8px 8px 8px;
  gap: 8px;
}

/* ä¸»å†…å®¹åŒºåŸŸ */
.main-content {
  flex: 1;
  background-color: #fff;
  border-radius: 20px;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.07);
  margin: 0;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* å·¥å…·æ  */
.toolbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 20px;
  height: 66px;
  background-color: #fff;
  border-bottom: 2px solid #e3f2fd;
}

.toolbar-left {
  display: flex;
  gap: 10px;
  align-items: center;
}

.tool-btn {
  height: 33px;
  padding: 0 16px;
  border: 1px solid #e0e0e0;
  border-radius: 12px;
  background-color: #ffffff;
  cursor: pointer;
  font-size: 15px;
  color: #222;
  display: flex;
  align-items: center;
  gap: 6px;
  box-sizing: border-box;
}

.tool-btn:hover {
  background-color: #f0f0f0;
}

.tool-btn.primary {
  background-color: #4285f4;
  color: white;
  border-color: #4285f4;
}

.tool-btn.primary:hover {
  background-color: #3367d6;
}

.tool-btn .el-icon {
  margin-right: 5px;
}

.toolbar-right {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 12px;
  color: #666;
}

.time {
  font-size: 12px;
  color: #666;
  margin-right: 10px;
}

/* é‚®ä»¶è¡¨å• */
.mail-form {
  padding: 10px 15px;
  border-bottom: 1px solid #e0e0e0;
  background-color: #fff;
}

.form-row {
  display: flex;
  align-items: center;
  margin-bottom: 8px;
}

.form-label {
  width: 70px;
  text-align: right;
  padding-right: 10px;
  font-size: 14px;
  color: #606266;
}

.form-field {
  flex: 1;
}

.form-actions {
  margin-left: 10px;
  display: flex;
  gap: 10px;
}

.action-link {
  color: #4e73df;
  cursor: pointer;
  font-size: 14px;
}

.action-link:hover {
  text-decoration: underline;
}

.recipient-select {
  width: 100%;
}

.user-option {
  display: flex;
  align-items: center;
  gap: 8px;
}

/* ç¼–è¾‘å™¨å·¥å…·æ  */
.editor-toolbar {
  padding: 8px 15px;
  border-bottom: 1px solid #e0e0e0;
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  background-color: #f5faff;
  align-items: center;
}

.toolbar-group {
  display: flex;
  align-items: center;
  gap: 2px;
  margin-right: 10px;
  flex-wrap: wrap;
}

.tool-icon {
  min-width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 4px;
  cursor: pointer;
  padding: 0 5px;
  font-size: 12px;
}

.tool-icon:hover {
  background-color: #ecf5ff;
}

.format-btn {
  display: flex;
  align-items: center;
  padding: 0 8px;
  height: 28px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
}

.format-btn:hover {
  background-color: #ecf5ff;
}

.format-btn .el-icon {
  margin-left: 5px;
}

/* ç¼–è¾‘å™¨å†…å®¹åŒº */
.editor-content {
  flex: 1;
  padding: 15px 20px;
  overflow-y: auto;
  min-height: 250px;
  outline: none;
  color: #303133;
  font-size: 14px;
}

/* å‘ä»¶äººä¿¡æ¯ */
.sender-info {
  padding: 10px 15px;
  border-top: 1px solid #e0e0e0;
  font-size: 14px;
  color: #606266;
  background-color: #f8f9fa;
}

.sender-name {
  color: #409eff;
  margin-left: 5px;
  cursor: pointer;
}

/* è”ç³»äººåˆ—è¡¨ */
.contact-list {
  width: 220px;
  background-color: #fff;
  border-left: 1px solid #e0e0e0;
  display: flex;
  flex-direction: column;
  flex-shrink: 0;
  border-radius: 4px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  margin-left: 8px;
  overflow: hidden;
}

.contact-header {
  padding: 12px 15px;
  font-size: 16px;
  font-weight: bold;
  border-bottom: 1px solid #e0e0e0;
  display: flex;
  justify-content: space-between;
  align-items: center;
  color: #4e73df;
  background-color: #f5faff;
}

.contact-search {
  padding: 10px;
  border-bottom: 1px solid #e0e0e0;
}

.contact-groups {
  flex: 1;
  overflow-y: auto;
  height: calc(100vh - 120px); /* è°ƒæ•´é«˜åº¦ä»¥é€‚åº”æ»šåŠ¨ */
}

.contact-group {
  margin-bottom: 2px;
}

.group-header {
  padding: 8px 12px;
  display: flex;
  align-items: center;
  cursor: pointer;
  background-color: #f5f7fa;
  font-size: 14px;
  color: #606266;
  border-radius: 4px;
  margin: 2px 4px;
}

.group-header .el-icon {
  margin-right: 5px;
  font-size: 12px;
  color: #909399;
}

.group-header .count {
  margin-left: 5px;
  font-size: 12px;
  color: #909399;
}

.group-contacts {
  padding: 2px 0;
}

.contact-item {
  padding: 6px 12px 6px 25px;
  display: flex;
  align-items: center;
  cursor: pointer;
  transition: background-color 0.2s;
  border-radius: 4px;
  margin: 2px 4px;
}

.contact-item:hover {
  background-color: #f5f7fa;
}

.contact-item .el-avatar {
  margin-right: 8px;
  background-color: #4e73df;
}

.contact-info {
  display: flex;
  flex-direction: column;
}

.contact-name {
  font-size: 13px;
  color: #303133;
}

.contact-email {
  font-size: 12px;
  color: #909399;
}
</style>