<template>
  <div class="mail-container">
    <!-- ä¸»ä½“å†…å®¹åŒº -->
    <div class="content-wrapper">
      <!-- å·¦ä¾§è¾¹æ  -->
      <div class="sidebar">
        <!-- é¡¶éƒ¨æŒ‰é’®åŒºåŸŸ -->
        <div class="sidebar-top">
          <button class="compose-btn active">
            <span class="icon icon--compose">
              <svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 14l8.5-8.5c.6-.6 1.6-.6 2.2 0l1.8 1.8c.6.6.6 1.6 0 2.2L7 18H3v-4z" fill="#f5a623"/>
                <path d="M12.3 3.7l4 4" stroke="#f5a623" stroke-width="1.5" stroke-linecap="round"/>
              </svg>
            </span>
            <span class="btn-text">å†™ä¿¡</span>
          </button>
          <div class="sidebar-divider"></div>
          <button class="inbox-btn">
            <span class="icon icon--inbox">
              <svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                <rect x="2" y="8" width="16" height="10" rx="2" fill="#FFB74D"/>
                <rect x="6" y="4" width="8" height="6" rx="1" fill="#E3F2FD" stroke="#64B5F6" stroke-width="1"/>
                <path d="M6 7l4 2 4-2" fill="none" stroke="#64B5F6" stroke-width="1"/>
              </svg>
            </span>
            <span class="btn-text">æ”¶ä¿¡</span>
          </button>
        </div>

        <!-- æ–‡ä»¶å¤¹åˆ—è¡¨ -->
        <div class="folder-list">
          <div class="folder-item">
            <span class="folder-icon">
              <!-- ä¿¡ç®±SVG -->
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><rect x="2" y="6" width="16" height="12" rx="3" stroke="#ff9800" stroke-width="1.5" fill="none"/><path d="M2 6l8 6 8-6" stroke="#ff9800" stroke-width="1.5" fill="none"/></svg>
            </span>
            <span class="folder-name">æ”¶ä»¶ç®±</span><span class="folder-badge">1</span>
          </div>
          <div class="folder-item">
            <span class="folder-icon">
              <!-- æ˜Ÿæ ‡SVG -->
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><polygon points="10,2 12,7.5 18,7.5 13,11.5 15,17 10,13.5 5,17 7,11.5 2,7.5 8,7.5" stroke="#ff9800" stroke-width="1.5" fill="none"/></svg>
            </span>
            <span class="folder-name">æ˜Ÿæ ‡é‚®ä»¶</span>
          </div>
          <div class="folder-item">
            <span class="folder-icon">
              <!-- çº¸é£æœºSVG -->
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><polygon points="2,18 18,10 2,2 5,10 2,18" stroke="#ff9800" stroke-width="1.5" fill="none"/></svg>
            </span>
            <span class="folder-name">å·²å‘é€</span>
          </div>
          <div class="folder-item">
            <span class="folder-icon">
              <!-- æ–‡ä»¶å¤¹SVG -->
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><rect x="2" y="6" width="16" height="10" rx="2" stroke="#ff9800" stroke-width="1.5" fill="none"/><path d="M2 6l6-4 4 4h6" stroke="#ff9800" stroke-width="1.5" fill="none"/></svg>
            </span>
            <span class="folder-name">è‰ç¨¿ç®±</span><span class="folder-badge">4</span>
          </div>
          <div class="folder-item">
            <span class="folder-icon">
              <!-- åƒåœ¾æ¡¶SVG -->
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><rect x="5" y="7" width="10" height="9" rx="2" stroke="#ff9800" stroke-width="1.5" fill="none"/><path d="M3 7h14" stroke="#ff9800" stroke-width="1.5" fill="none"/><path d="M8 10v3" stroke="#ff9800" stroke-width="1.2"/><path d="M12 10v3" stroke="#ff9800" stroke-width="1.2"/></svg>
            </span>
            <span class="folder-name">å·²åˆ é™¤</span>
          </div>
          <div class="folder-item">
            <span class="folder-icon">
              <!-- åƒåœ¾ç®±SVG -->
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><rect x="2" y="6" width="16" height="12" rx="3" stroke="#ff9800" stroke-width="1.5" fill="none"/><rect x="8" y="10" width="4" height="4" rx="1" stroke="#ff9800" stroke-width="1.2" fill="none"/></svg>
            </span>
            <span class="folder-name">åƒåœ¾ç®±</span><span class="folder-badge">8</span>
          </div>
          <div class="folder-item">
            <span class="folder-icon">
              <!-- æ–‡ä»¶å¤¹SVG -->
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><polygon points="2,18 18,10 2,2 5,10 2,18" stroke="#ff9800" stroke-width="1.5" fill="none"/></svg>
            </span>
            <span class="folder-name">æˆ‘çš„æ–‡ä»¶å¤¹</span>
          </div>
        </div>
      </div>
      
      <!-- ä¸»å†…å®¹åŒºåŸŸ -->
      <div class="main-content">
        <div class="header">
      <div class="header-left">
        <img class="header-image" :src="topImage" alt="header" />
      </div>
      <div class="header-right">
        <div class="header-search">
    <span class="search-icon">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
        <circle cx="7" cy="7" r="6" stroke="#bdbdbd" stroke-width="1.5" fill="none"/>
        <path d="M12 12l-2.5-2.5" stroke="#bdbdbd" stroke-width="1.5" stroke-linecap="round"/>
      </svg>
    </span>
          <input class="search-input" type="text" placeholder="æœç´¢" />
        </div>
      </div>
    </div>
        <!-- å·¥å…·æ  -->
        <div class="toolbar">
          <div class="toolbar-left">
            <div class="tool-btn primary" @click="sendMailHandler">
              <el-icon><Position /></el-icon>
              <span>å‘é€</span>
            </div>
            <div class="tool-btn">
              <el-icon><View /></el-icon>
              <span>é¢„è§ˆ</span>
            </div>
            <div class="tool-btn" @click="triggerFileUpload">
              <el-icon><Files /></el-icon>
              <span>é™„ä»¶</span>
            </div>

            <div class="tool-btn">
              <el-icon><Files /></el-icon>
              <span>è¶…å¤§é™„ä»¶</span>
            </div>
            <el-dropdown trigger="click">
              <div class="tool-btn">
                <el-icon><Setting /></el-icon>
                <span>å‘ä¿¡è®¾ç½®</span>
                <el-icon class="el-icon--right"><ArrowDown /></el-icon>
              </div>
              <template #dropdown>
                <el-dropdown-menu>
                  <el-dropdown-item>å®šæ—¶å‘é€</el-dropdown-item>
                  <el-dropdown-item>è¯·æ±‚å·²è¯»å›æ‰§</el-dropdown-item>
                  <el-dropdown-item>è®¾ç½®ä¼˜å…ˆçº§</el-dropdown-item>
                </el-dropdown-menu>
              </template>
            </el-dropdown>
          </div>
          <div class="toolbar-right">
            <span class="time" style="min-width: 180px; white-space: nowrap;">å·²äº{{ currentTime }}ä¿å­˜è‡³è‰ç¨¿</span>
            <div class="tool-btn" @click="closeEditor">
              <el-icon><Close /></el-icon>
            </div>
          </div>
        </div>
        
        <!-- é‚®ä»¶è¡¨å•åŒºåŸŸ -->
        <div class="mail-form">
          <!-- æ”¶ä»¶äººè¡Œ -->
          <div class="form-row">
            <div class="form-label">æ”¶ä»¶äººï¼š</div>
            <div class="form-field">
              <el-select
                v-model="mailForm.recipients"
                multiple
                filterable
                remote
                reserve-keyword
                allow-create
                default-first-option
                placeholder="è¯·è¾“å…¥æ”¶ä»¶äººå§“åã€å·¥å·æˆ–é‚®ç®±åœ°å€"
                :remote-method="remoteSearch"
                :loading="loading"
                class="recipient-select"
                @change="validateRecipients"
              >
                <el-option
                  v-for="item in userOptions"
                  :key="item.value"
                  :label="item.label"
                  :value="item.value"
                >
                  <div class="user-option">
                    <el-avatar :size="24" :src="item.avatar">{{ item.label.substring(0, 1) }}</el-avatar>
                    <span>{{ item.label }}</span>
                  </div>
                </el-option>
              </el-select>
            </div>
            <div class="form-actions">
              <span class="action-link" @click="showCc = !showCc">æŠ„é€</span>
              <span class="action-link" @click="showBcc = !showBcc">å¯†é€</span>
              <span>|</span>
              <span class="action-link">åˆ†åˆ«å‘é€</span>
            </div>
          </div>
          
          <!-- æŠ„é€è¡Œ -->
          <div class="form-row" v-if="showCc">
            <div class="form-label">æŠ„é€ï¼š</div>
            <div class="form-field">
              <el-select
                v-model="mailForm.cc"
                multiple
                filterable
                remote
                reserve-keyword
                allow-create
                default-first-option
                placeholder="è¯·è¾“å…¥æŠ„é€äººå§“åã€å·¥å·æˆ–é‚®ç®±åœ°å€"
                :remote-method="remoteSearch"
                :loading="loading"
                class="recipient-select"
                @change="validateCc"
              >
                <el-option
                  v-for="item in userOptions"
                  :key="item.value"
                  :label="item.label"
                  :value="item.value"
                >
                  <div class="user-option">
                    <el-avatar :size="24" :src="item.avatar">{{ item.label.substring(0, 1) }}</el-avatar>
                    <span>{{ item.label }}</span>
                  </div>
                </el-option>
              </el-select>
            </div>
          </div>
          
          <!-- å¯†é€è¡Œ -->
          <div class="form-row" v-if="showBcc">
            <div class="form-label">å¯†é€ï¼š</div>
            <div class="form-field">
              <el-select
                v-model="mailForm.bcc"
                multiple
                filterable
                remote
                reserve-keyword
                allow-create
                default-first-option
                placeholder="è¯·è¾“å…¥å¯†é€äººå§“åã€å·¥å·æˆ–é‚®ç®±åœ°å€"
                :remote-method="remoteSearch"
                :loading="loading"
                class="recipient-select"
                @change="validateBcc"
              >
                <el-option
                  v-for="item in userOptions"
                  :key="item.value"
                  :label="item.label"
                  :value="item.value"
                >
                  <div class="user-option">
                    <el-avatar :size="24" :src="item.avatar">{{ item.label.substring(0, 1) }}</el-avatar>
                    <span>{{ item.label }}</span>
                  </div>
                </el-option>
              </el-select>
            </div>
          </div>
          
          <!-- ä¸»é¢˜è¡Œ -->
          <div class="form-row">
            <div class="form-label">ä¸»é¢˜ï¼š</div>
            <div class="form-field">
              <el-input placeholder="è¯·è¾“å…¥é‚®ä»¶ä¸»é¢˜" v-model="mailForm.subject" />
            </div>
          </div>
        </div>
        
        <!-- ç¼–è¾‘å™¨å·¥å…·æ  -->
        <div class="editor-toolbar" style="background-color: #f5faff; border-bottom: 1px solid #e0e0e0; padding: 10px 20px;">
          <div class="toolbar-group">
            <div class="tool-btn">
              <el-icon><ArrowLeftBold /></el-icon>
            </div>
            <div class="tool-btn">
              <el-icon><ArrowRightBold /></el-icon>
            </div>
            <div class="tool-btn">
              <el-icon><PictureFilled /></el-icon>
            </div>
            <div class="tool-btn">
              <el-icon><Link /></el-icon>
            </div>
            <div class="tool-btn">
              <el-icon><Document /></el-icon>
            </div>
            <div class="tool-btn">
              <el-icon><Clock /></el-icon>
            </div>
            <div class="tool-btn">
              <el-icon><Avatar /></el-icon>
            </div>
          </div>
          
          <div class="toolbar-group">
            <div class="tool-select">
              <span>é»˜è®¤å­—ä½“</span>
              <el-icon><ArrowDown /></el-icon>
            </div>
            
            <div class="tool-select">
              <span>å­—å·</span>
              <el-icon><ArrowDown /></el-icon>
            </div>
          </div>
          
          <div class="toolbar-group">
            <div class="tool-btn" @click="execFormatCommand('bold')" title="åŠ ç²—">
              <font-awesome-icon :icon="['fas', 'bold']" />
            </div>
            <div class="tool-btn" @click="execFormatCommand('italic')" title="æ–œä½“">
              <font-awesome-icon :icon="['fas', 'italic']" />
            </div>
            <div class="tool-btn" @click="execFormatCommand('underline')" title="ä¸‹åˆ’çº¿">
              <font-awesome-icon :icon="['fas', 'underline']" />
            </div>
            <div class="tool-btn">
              <el-icon><Delete /></el-icon>
            </div>
            <div class="tool-btn">
              <el-icon><Edit /></el-icon>
            </div>
          </div>
          
          <div class="toolbar-group">
            <div class="tool-btn" @click="execFormatCommand('insertUnorderedList')" title="æ— åºåˆ—è¡¨">
              <font-awesome-icon :icon="['fas', 'list-ul']" />
            </div>
            <div class="tool-btn" @click="execFormatCommand('insertOrderedList')" title="æœ‰åºåˆ—è¡¨">
              <font-awesome-icon :icon="['fas', 'list-ol']" />
            </div>
            <div class="tool-btn" @click="execFormatCommand('justifyLeft')" title="å·¦å¯¹é½">
              <font-awesome-icon :icon="['fas', 'align-left']" />
            </div>
            <div class="tool-btn" @click="execFormatCommand('justifyCenter')" title="å±…ä¸­å¯¹é½">
              <font-awesome-icon :icon="['fas', 'align-center']" />
            </div>
            <div class="tool-btn" @click="execFormatCommand('justifyRight')" title="å³å¯¹é½">
              <font-awesome-icon :icon="['fas', 'align-right']" />
            </div>
            <div class="tool-btn" @click="execFormatCommand('justifyFull')" title="ä¸¤ç«¯å¯¹é½">
              <font-awesome-icon :icon="['fas', 'align-justify']" />
            </div>
          </div>
        </div>
        
        <!-- ç¼–è¾‘å™¨å†…å®¹åŒº -->
        <div class="editor-content" contenteditable="true" @input="handleEditorInput" style="flex: 1; padding: 20px; background-color: #ffffff; min-height: 300px; outline: none; border-radius: 0 0 4px 4px;">
          <p>è¯·è¾“å…¥æ­£æ–‡</p>
        </div>
        
        <!-- éšè—çš„æ–‡ä»¶è¾“å…¥ -->
        <input 
          id="file-input" 
          type="file" 
          multiple 
          style="display: none" 
          @change="(e: Event) => handleFileUpload(((e.target as HTMLInputElement).files))"
        />
        
        <!-- é™„ä»¶åˆ—è¡¨ -->
        <div v-if="mailForm.attachments.length > 0" class="attachments-list" style="padding: 10px 20px; border-top: 1px solid #e0e0e0;">
          <div class="attachment-item" v-for="(file, index) in mailForm.attachments" :key="index" style="display: inline-flex; align-items: center; margin-right: 10px; margin-bottom: 5px; padding: 6px 10px; background: #f0f0f0; border-radius: 6px; font-size: 12px;">
            <el-icon style="margin-right: 5px; color: #409eff;"><Files /></el-icon>
            <div style="display: flex; flex-direction: column;">
              <span>{{ file.name }}</span>
              <span style="color: #666; font-size: 10px;">{{ formatFileSize(file.size) }}</span>
            </div>
            <span @click="removeAttachment(index)" style="margin-left: 8px; cursor: pointer; color: #f56c6c; font-weight: bold;" title="åˆ é™¤é™„ä»¶">&times;</span>
          </div>
        </div>
        
        <!-- å‘ä»¶äººä¿¡æ¯ -->
        <div class="sender-info">
          <span>å‘ä»¶äººï¼š</span>
          <span>{{ currentUser }}</span>
        </div>
      </div>
      
      <!-- å³ä¾§è”ç³»äººåˆ—è¡¨ -->
      <div class="contact-list" style="width: 220px; background-color: #ffffff; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-left: 8px; overflow: hidden;">
        <div class="contact-header" style="padding: 12px 15px; font-size: 16px; font-weight: bold; border-bottom: 1px solid #e6e6e6; background-color: #f5faff;">
          <span>è”ç³»äºº</span>
        </div>
        
        <div class="contact-search" style="padding: 10px; border-bottom: 1px solid #e6e6e6;">
          <div class="header-search" style="width: 100%; height: 32px;">
            <span class="search-icon">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <circle cx="7" cy="7" r="6" stroke="#bdbdbd" stroke-width="1.5" fill="none"/>
                <path d="M12 12l-2.5-2.5" stroke="#bdbdbd" stroke-width="1.5" stroke-linecap="round"/>
              </svg>
            </span>
            <input class="search-input" type="text" placeholder="æœç´¢è”ç³»äºº" v-model="contactSearch" />
          </div>
        </div>
        
        <div class="contact-groups" style="flex: 1; overflow-y: auto; padding: 10px;">
          <div 
            v-for="(group, index) in contactGroups" 
            :key="index"
            class="contact-group"
            style="margin-bottom: 10px;"
          >
            <div 
              class="folder-item" 
              @click="toggleGroupExpand(index)"
              style="display: flex; align-items: center; padding: 6px 4px; cursor: pointer; font-size: 12px; color: #333; border-radius: 2px; margin-bottom: 2px;"
            >
              <span class="folder-icon">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                  <path d="M4 6l4 4 4-4" stroke="#ff9800" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" :transform="!group.expanded ? 'rotate(-90 8 8)' : ''"/>
                </svg>
              </span>
              <span class="folder-name">{{ group.name }}</span>
              <span class="folder-badge">{{ group.contacts.length }}</span>
            </div>
            
            <div class="group-contacts" v-if="group.expanded">
                          <div 
              v-for="contact in filteredContacts(group.contacts)" 
              :key="contact.id"
              class="contact-item"
              @click="addRecipient(contact)"
            >
              <el-avatar :size="24">{{ contact.name.substring(0, 1) }}</el-avatar>
              <div class="contact-info" style="flex: 1; min-width: 0; overflow: hidden;">
                <div class="contact-name" style="font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{{ contact.name }}</div>
                <div class="contact-email" style="font-size: 11px; color: #666; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{{ contact.email }}</div>
                <div v-if="contact.deptName" class="contact-dept" style="font-size: 10px; color: #999; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{{ contact.deptName }}</div>
              </div>
            </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted } from 'vue'
import { useRouter } from 'vue-router'
import { ElMessage, ElMessageBox } from 'element-plus'
import { useUserStore } from '@/store/modules/user'
import { sendMail, saveDraft, type CreateMailContentReqVO } from '@/api/system/mail/letter/index'
import { getSimpleUserList } from '@/api/system/user'
import { getAccessToken } from '@/utils/auth'
import '@/views/mail/mail.css'
import topImage from '@/views/mail/image/top.png'

// å¯¼å…¥Font Awesomeç»„ä»¶å’Œå›¾æ ‡
import { FontAwesomeIcon } from '@fortawesome/vue-fontawesome'
import { library } from '@fortawesome/fontawesome-svg-core'
import {
  faAlignLeft,
  faAlignCenter,
  faAlignRight,
  faAlignJustify,
  faListUl,
  faListOl,
  faBold,
  faItalic,
  faUnderline
} from '@fortawesome/free-solid-svg-icons'

// æ·»åŠ å›¾æ ‡åˆ°åº“
library.add(
  faAlignLeft,
  faAlignCenter,
  faAlignRight,
  faAlignJustify,
  faListUl,
  faListOl,
  faBold,
  faItalic,
  faUnderline
)
import {
  Document,
  Edit,
  Position,
  Files,
  Delete,
  ArrowDown,
  Setting,
  Clock,
  Avatar,
  PictureFilled,
  Link,
  ArrowRightBold,
  ArrowLeftBold,
  View,
  Close
} from '@element-plus/icons-vue'

// å¯¼å…¥mockæ•°æ®
import { 
  userOptions as mockUserOptions, 
  contactGroups as mockContactGroups
} from './mock/write.js'

const router = useRouter()

// è¡¨å•æ•°æ®
const mailForm = ref<{
  recipients: string[]
  cc: string[]
  bcc: string[]
  subject: string
  content: string
  attachments: File[]
}>({
  recipients: [],
  cc: [],
  bcc: [],
  subject: '',
  content: '',
  attachments: []
})

// UIçŠ¶æ€
const showCc = ref(false)
const showBcc = ref(false)
const contactSearch = ref('')
const loading = ref(false)

// ä½¿ç”¨mockæ•°æ®ï¼Œæ›´æ–°userOptionsä»¥åŒ…å«é‚®ç®±åœ°å€
const userOptions = ref(mockUserOptions.map(user => ({
  ...user,
  value: user.value.includes('@') ? user.value : `${user.value}@example.com`,
  label: user.value.includes('@') ? user.label : `${user.label} <${user.value}@example.com>`
})))
const contactGroups = ref(mockContactGroups.map(group => ({ ...group, expanded: true })))

// å½“å‰ç”¨æˆ·ä¿¡æ¯
const userStore = useUserStore();
const currentUser = computed(() => userStore.getUser.nickname || 'æœªç™»å½•ç”¨æˆ·');

// å½“å‰æ—¶é—´
const currentTime = computed(() => {
  const now = new Date()
  const hours = now.getHours().toString().padStart(2, '0')
  const minutes = now.getMinutes().toString().padStart(2, '0')
  return `${hours}:${minutes}`
})



// é‚®ç®±æ ¼å¼éªŒè¯ - ä¿®æ”¹ä¸ºå¯é€‰éªŒè¯
const isValidEmail = (email: string): boolean => {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
  return emailRegex.test(email)
}

// æœç´¢ç”¨æˆ·/è”ç³»äºº - ä½¿ç”¨getSimpleUserListè·å–çœŸå®ç”¨æˆ·æ•°æ®
const remoteSearch = async (query: string) => {
  console.log(`ğŸ” å¼€å§‹æœç´¢è”ç³»äººï¼Œå…³é”®è¯: "${query}"`)
  
  try {
    loading.value = true
    console.log('ğŸ“¡ è°ƒç”¨åç«¯ç”¨æˆ·åˆ—è¡¨API...')
    
    // è°ƒç”¨getSimpleUserListè·å–æ‰€æœ‰ç”¨æˆ·
    const users = await getSimpleUserList()
    for (const user of users) {
      console.log(user.deptNames)
    }
    
    if (users && Array.isArray(users)) {
      console.log(`âœ… è·å–ç”¨æˆ·åˆ—è¡¨æˆåŠŸï¼Œå…± ${users.length} ä¸ªç”¨æˆ·`)
      
      // å¦‚æœæœ‰æœç´¢å…³é”®è¯ï¼Œè¿›è¡Œè¿‡æ»¤
      let filteredUsers = users
      if (query) {
        filteredUsers = users.filter(user => 
          (user.nickname && user.nickname.toLowerCase().includes(query.toLowerCase())) ||
          (user.username && user.username.toLowerCase().includes(query.toLowerCase())) ||
          (user.email && user.email.toLowerCase().includes(query.toLowerCase()))
        )
        console.log(`ğŸ” è¿‡æ»¤åæ‰¾åˆ° ${filteredUsers.length} ä¸ªåŒ¹é…ç”¨æˆ·`)
      }
      
      // è½¬æ¢ä¸ºå‰ç«¯éœ€è¦çš„æ ¼å¼
      userOptions.value = filteredUsers.slice(0, 50).map((user: any) => ({
        value: user.id.toString(), // ä½¿ç”¨ç”¨æˆ·IDä½œä¸ºå€¼
        label: `${user.nickname || user.username} <${user.deptNames ? user.deptNames.join(', ') : ''}>`, // æ˜¾ç¤ºæ ¼å¼ï¼šå§“å <éƒ¨é—¨åç§°>
        avatar: user.avatar || '',
        name: user.nickname || user.username,
        email: user.username, // ç”¨æˆ·åä½œä¸ºé‚®ç®±æ ‡è¯†
        userId: user.id,
        deptName: user.deptNames ? user.deptNames.join(', ') : '' // ä½¿ç”¨éƒ¨é—¨åç§°
      }))
      
      console.log('ğŸ”„ æ›´æ–°ç”¨æˆ·é€‰é¡¹åˆ—è¡¨:', userOptions.value)
    } else {
      console.warn('âš ï¸ APIæ²¡æœ‰è¿”å›æ•°æ®ï¼Œä½¿ç”¨mockæ•°æ®')
      // å¦‚æœAPIæ²¡æœ‰è¿”å›æ•°æ®ï¼Œä½¿ç”¨mockæ•°æ®
      const filteredMockUsers = mockUserOptions.filter(user => 
        user.label.toLowerCase().includes(query.toLowerCase()) ||
        user.value.toLowerCase().includes(query.toLowerCase())
      )
      userOptions.value = filteredMockUsers
      console.log('ğŸ“‹ ä½¿ç”¨è¿‡æ»¤åçš„mockæ•°æ®:', userOptions.value)
    }
  } catch (error: unknown) {
    console.error('âŒ æœç´¢è”ç³»äººå¤±è´¥:', error)
    console.error('ğŸ” æœç´¢é”™è¯¯è¯¦æƒ…:', {
      message: (error as any)?.message,
      response: (error as any)?.response,
      status: (error as any)?.response?.status
    })
    // é™çº§ä½¿ç”¨mockæ•°æ®
    const filteredMockUsers = mockUserOptions.filter(user => 
      user.label.toLowerCase().includes(query.toLowerCase()) ||
      user.value.toLowerCase().includes(query.toLowerCase())
    )
    userOptions.value = filteredMockUsers
    console.log('ğŸ“‹ é™çº§ä½¿ç”¨mockæ•°æ®:', userOptions.value)
  } finally {
    loading.value = false
    console.log('ğŸ æœç´¢å®Œæˆï¼ŒloadingçŠ¶æ€:', loading.value)
  }
}



// åˆ‡æ¢åˆ†ç»„å±•å¼€çŠ¶æ€
const toggleGroupExpand = (index) => {
  contactGroups.value[index].expanded = !contactGroups.value[index].expanded
}

// è¿‡æ»¤è”ç³»äºº
const filteredContacts = (contacts) => {
  if (!contactSearch.value) return contacts
  return contacts.filter(contact => 
    contact.name.toLowerCase().includes(contactSearch.value.toLowerCase()) || 
    contact.email.toLowerCase().includes(contactSearch.value.toLowerCase())
  )
}

// éªŒè¯æ”¶ä»¶äºº - ä¿®æ”¹ä¸ºæ”¯æŒå§“åè¾“å…¥
const validateRecipients = () => {
  // å¯¹äºOAå†…éƒ¨äººå‘˜ï¼Œå…è®¸è¾“å…¥å§“åï¼Œä¸éœ€è¦å¼ºåˆ¶é‚®ç®±æ ¼å¼
  // è¿™é‡Œå¯ä»¥æ·»åŠ å…¶ä»–éªŒè¯é€»è¾‘ï¼Œæ¯”å¦‚æ£€æŸ¥å§“åæ˜¯å¦åœ¨è”ç³»äººåˆ—è¡¨ä¸­
  console.log('æ”¶ä»¶äººéªŒè¯é€šè¿‡:', mailForm.value.recipients)
}

// éªŒè¯æŠ„é€äºº - ä¿®æ”¹ä¸ºæ”¯æŒå§“åè¾“å…¥
const validateCc = () => {
  // å¯¹äºOAå†…éƒ¨äººå‘˜ï¼Œå…è®¸è¾“å…¥å§“åï¼Œä¸éœ€è¦å¼ºåˆ¶é‚®ç®±æ ¼å¼
  console.log('æŠ„é€äººéªŒè¯é€šè¿‡:', mailForm.value.cc)
}

// éªŒè¯å¯†é€äºº - ä¿®æ”¹ä¸ºæ”¯æŒå§“åè¾“å…¥
const validateBcc = () => {
  // å¯¹äºOAå†…éƒ¨äººå‘˜ï¼Œå…è®¸è¾“å…¥å§“åï¼Œä¸éœ€è¦å¼ºåˆ¶é‚®ç®±æ ¼å¼
  console.log('å¯†é€äººéªŒè¯é€šè¿‡:', mailForm.value.bcc)
}

// æ·»åŠ æ”¶ä»¶äºº - ä¿®æ”¹ä¸ºæ”¯æŒå§“åè¾“å…¥
const addRecipient = (contact: any) => {
  const identifier = contact.email || contact.name
  if (identifier && !mailForm.value.recipients.includes(identifier)) {
    mailForm.value.recipients.push(identifier)
  }
}

// å¤„ç†ç¼–è¾‘å™¨è¾“å…¥
const handleEditorInput = (e: Event) => {
  const target = e.target as HTMLElement
  // ä½¿ç”¨textContentè·å–çº¯æ–‡æœ¬ï¼Œæˆ–è€…ä½¿ç”¨innerHTMLä½†éœ€è¦è¿›è¡ŒXSSè¿‡æ»¤
  mailForm.value.content = target.innerHTML
}

// è§¦å‘æ–‡ä»¶é€‰æ‹©
const triggerFileUpload = () => {
  const fileInput = document.getElementById('file-input') as HTMLInputElement
  if (fileInput) {
    fileInput.click()
  }
}

// æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
const formatFileSize = (bytes: number): string => {
  if (bytes === 0) return '0 B'
  const k = 1024
  const sizes = ['B', 'KB', 'MB', 'GB']
  const i = Math.floor(Math.log(bytes) / Math.log(k))
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]
}

// åˆ é™¤é™„ä»¶
const removeAttachment = (index: number) => {
  const fileName = mailForm.value.attachments[index].name
  mailForm.value.attachments.splice(index, 1)
  ElMessage.success(`å·²åˆ é™¤é™„ä»¶: ${fileName}`)
}

// é‡ç½®è¡¨å•
const resetForm = () => {
  mailForm.value = {
    recipients: [],
    cc: [],
    bcc: [],
    subject: '',
    content: '',
    attachments: []
  }
  
  // é‡ç½®ç¼–è¾‘å™¨å†…å®¹
  const editorContent = document.querySelector('.editor-content')
  if (editorContent) {
    editorContent.innerHTML = '<p>è¯·è¾“å…¥æ­£æ–‡</p>'
  }
  
  // éšè—æŠ„é€å’Œå¯†é€
  showCc.value = false
  showBcc.value = false
}

// å¤„ç†æ–‡ä»¶ä¸Šä¼ 
const handleFileUpload = (files: FileList | null) => {
  if (files) {
    const newFiles = Array.from(files)
    // éªŒè¯æ–‡ä»¶å¤§å°ï¼ˆé™åˆ¶æ¯ä¸ªæ–‡ä»¶æœ€å¤§25MBï¼‰
    const oversizedFiles = newFiles.filter(file => file.size > 25 * 1024 * 1024)
    if (oversizedFiles.length > 0) {
      ElMessage.warning(`æ–‡ä»¶ ${oversizedFiles.map(f => f.name).join(', ')} è¶…è¿‡25MBé™åˆ¶`)
      return
    }
    
    mailForm.value.attachments = [...mailForm.value.attachments, ...newFiles]
    ElMessage.success(`æˆåŠŸæ·»åŠ  ${newFiles.length} ä¸ªé™„ä»¶`)
  }
}

// å‘é€é‚®ä»¶
const sendMailHandler = async () => {
  if (!mailForm.value.recipients.length) {
    ElMessage.warning('è¯·é€‰æ‹©æ”¶ä»¶äºº')
    return
  }
  
  if (!mailForm.value.subject) {
    try {
      await ElMessageBox.confirm('æ˜¯å¦ç¡®è®¤å‘é€æ— ä¸»é¢˜é‚®ä»¶ï¼Ÿ', 'æç¤º', {
        confirmButtonText: 'ç¡®å®š',
        cancelButtonText: 'å–æ¶ˆ',
        type: 'warning'
      })
    } catch {
      return
    }
  }
  
  await doSendMail()
}

// å¤„ç†æ”¶ä»¶äººï¼šå°†å§“åè½¬æ¢ä¸ºç”¨æˆ·IDï¼Œä½¿ç”¨getSimpleUserListè·å–çœŸå®ç”¨æˆ·æ•°æ®
const processRecipients = async (recipients: string[]): Promise<string[]> => {
  const processedUserIds: string[] = []
  
  try {
    // è·å–æ‰€æœ‰ç”¨æˆ·åˆ—è¡¨
    const users = await getSimpleUserList()
    
    for (const recipient of recipients) {
      // æ£€æŸ¥æ˜¯å¦å·²ç»æ˜¯ç”¨æˆ·IDï¼ˆæ•°å­—æ ¼å¼ï¼‰
      if (/^\d+$/.test(recipient)) {
        // å¦‚æœå·²ç»æ˜¯ç”¨æˆ·IDæ ¼å¼ï¼Œç›´æ¥æ·»åŠ 
        processedUserIds.push(recipient)
      } else if (isValidEmail(recipient)) {
        // å¦‚æœæ˜¯é‚®ç®±æ ¼å¼ï¼Œéœ€è¦æŸ¥æ‰¾å¯¹åº”çš„ç”¨æˆ·ID
        const user = users.find((u: any) => 
          u.username === recipient || u.email === recipient
        )
        if (user && user.id) {
          processedUserIds.push(user.id.toString())
        } else {
          // å¦‚æœæ‰¾ä¸åˆ°ç”¨æˆ·ï¼Œä½¿ç”¨é‚®ç®±ä½œä¸ºæ ‡è¯†ç¬¦
          processedUserIds.push(recipient)
        }
      } else {
        // å¦‚æœæ˜¯å§“åï¼Œå°è¯•æŸ¥æ‰¾å¯¹åº”çš„ç”¨æˆ·ID
        const user = users.find((u: any) => 
          u.nickname === recipient || 
          u.username === recipient ||
          (u.nickname && u.nickname.toLowerCase().includes(recipient.toLowerCase())) ||
          (u.username && u.username.toLowerCase().includes(recipient.toLowerCase()))
        )
        if (user && user.id) {
          processedUserIds.push(user.id.toString())
        } else {
          // å¦‚æœæ‰¾ä¸åˆ°ç”¨æˆ·ï¼Œä½¿ç”¨å§“åä½œä¸ºæ ‡è¯†ç¬¦
          processedUserIds.push(recipient)
        }
      }
    }
  } catch (error: unknown) {
    console.error('âŒ è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥ï¼Œä½¿ç”¨åŸå§‹æ”¶ä»¶äººä¿¡æ¯:', error)
    // å¦‚æœAPIè°ƒç”¨å¤±è´¥ï¼Œç›´æ¥ä½¿ç”¨åŸå§‹æ”¶ä»¶äººä¿¡æ¯
    return recipients
  }
  
  return processedUserIds
}

// æ‰§è¡Œå‘é€é‚®ä»¶
const doSendMail = async () => {
  try {
    loading.value = true
    
    // éªŒè¯å¿…å¡«å­—æ®µ
    if (!mailForm.value.recipients.length) {
      ElMessage.warning('è¯·é€‰æ‹©æ”¶ä»¶äºº')
      return
    }
    
    // è·å–ç¼–è¾‘å™¨å®é™…å†…å®¹
    const editorContent = document.querySelector('.editor-content')?.innerHTML || ''
    
    // å¤„ç†æ”¶ä»¶äººï¼šè½¬æ¢ä¸ºç”¨æˆ·ID
    const processedRecipients = await processRecipients(mailForm.value.recipients)
    
    // å¤„ç†æŠ„é€äººï¼šè½¬æ¢ä¸ºç”¨æˆ·ID
    const processedCc = mailForm.value.cc.length > 0 ? await processRecipients(mailForm.value.cc) : []
    
    const sendData: CreateMailContentReqVO = {
      subject: mailForm.value.subject || '(æ— ä¸»é¢˜)',
      content: editorContent,
      senderId: userStore.getUser.id, // å‘ä»¶äººID
      receiverIds: processedRecipients.join(','), // æ”¶ä»¶äººIDåˆ—è¡¨ï¼Œé€—å·åˆ†éš”
      ccUserIds: processedCc.length > 0 ? processedCc.join(',') : undefined, // æŠ„é€äººIDåˆ—è¡¨ï¼Œé€—å·åˆ†éš”
      priority: 1, // é»˜è®¤æ™®é€šä¼˜å…ˆçº§
      isDraft: false, // ä¸æ˜¯è‰ç¨¿
      requestReadReceipt: false, // é»˜è®¤ä¸è¯·æ±‚å·²è¯»å›æ‰§
      status: 0, // æ­£å¸¸çŠ¶æ€
      folder: 'sent' // å·²å‘é€æ–‡ä»¶å¤¹
    }
    
    console.log('å‘é€é‚®ä»¶æ•°æ®:', sendData)
    
    // æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€
    const currentToken = getAccessToken()
    console.log('ğŸ”‘ å½“å‰ accessToken:', currentToken ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®')
    console.log('ğŸ‘¤ ç”¨æˆ·ä¿¡æ¯:', userStore.getUser)
    
    if (!currentToken) {
      ElMessage.error('ç”¨æˆ·æœªç™»å½•ï¼Œè¯·å…ˆç™»å½•')
      router.push('/login')
      return
    }
    
    // ç›´æ¥è°ƒç”¨å‘é€é‚®ä»¶APIï¼Œaxiosæ‹¦æˆªå™¨ä¼šè‡ªåŠ¨æºå¸¦token
    await sendMail(sendData)
    ElMessage.success('é‚®ä»¶å‘é€æˆåŠŸ')
    
    // æ¸…ç©ºè¡¨å•
    resetForm()
    router.push('/mail')
  } catch (error: any) {
    console.error('å‘é€é‚®ä»¶å¤±è´¥:', error)
    const errorMsg = error?.response?.data?.message || error?.message || 'ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•'
    ElMessage.error(`å‘é€å¤±è´¥: ${errorMsg}`)
  } finally {
    loading.value = false
  }
}

// ä¿å­˜è‰ç¨¿ - ä¿®å¤ç±»å‹é”™è¯¯
const saveDraftHandler = async () => {
  try {
    // è·å–ç¼–è¾‘å™¨å®é™…å†…å®¹
    const editorContent = document.querySelector('.editor-content')?.innerHTML || ''
    
    // å¤„ç†æ”¶ä»¶äººï¼šè½¬æ¢ä¸ºç”¨æˆ·ID
    const processedRecipients = await processRecipients(mailForm.value.recipients)
    
    // å¤„ç†æŠ„é€äººï¼šè½¬æ¢ä¸ºç”¨æˆ·ID
    const processedCc = mailForm.value.cc.length > 0 ? await processRecipients(mailForm.value.cc) : []
    
    const draftData: CreateMailContentReqVO = {
      subject: mailForm.value.subject,
      content: editorContent,
      senderId: userStore.getUser.id, // å‘ä»¶äººID
      receiverIds: processedRecipients.join(','), // æ”¶ä»¶äººIDåˆ—è¡¨ï¼Œé€—å·åˆ†éš”
      ccUserIds: processedCc.length > 0 ? processedCc.join(',') : undefined, // æŠ„é€äººIDåˆ—è¡¨ï¼Œé€—å·åˆ†éš”
      priority: 1,
      isDraft: true, // æ˜¯è‰ç¨¿
      requestReadReceipt: false,
      status: 0, // æ­£å¸¸çŠ¶æ€
      folder: 'drafts' // è‰ç¨¿æ–‡ä»¶å¤¹
    }
    
    console.log('ä¿å­˜è‰ç¨¿æ•°æ®:', draftData)
    
    await saveDraft(draftData)
    ElMessage.success('è‰ç¨¿ä¿å­˜æˆåŠŸ')
    router.push('/mail')
  } catch (error: any) {
    console.error('ä¿å­˜è‰ç¨¿å¤±è´¥:', error)
    const errorMsg = error?.response?.data?.message || error?.message || 'ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•'
    ElMessage.error(`ä¿å­˜å¤±è´¥: ${errorMsg}`)
  }
}

// å…³é—­ç¼–è¾‘å™¨
const closeEditor = async () => {
  try {
    await ElMessageBox.confirm('æ˜¯å¦ä¿å­˜è‰ç¨¿ï¼Ÿ', 'æç¤º', {
      confirmButtonText: 'ä¿å­˜',
      cancelButtonText: 'ä¸ä¿å­˜',
      distinguishCancelAndClose: true,
      closeOnClickModal: false
    })
    
    // ä¿å­˜è‰ç¨¿
    await saveDraftHandler()
  } catch (action) {
    if (action === 'cancel') {
      // ä¸ä¿å­˜ï¼Œç›´æ¥è¿”å›
      router.push('/mail')
    }
  }
}



// æ–‡æœ¬æ ¼å¼åŒ–å‘½ä»¤
const execFormatCommand = (command: string) => {
  document.execCommand(command, false, '')
}

onMounted(async () => {
  // åˆå§‹åŒ–ç¼–è¾‘å™¨
  console.log('ğŸš€ ç»„ä»¶æŒ‚è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–ç”¨æˆ·åˆ—è¡¨...')
  
  try {
    // è·å–åˆå§‹ç”¨æˆ·åˆ—è¡¨
    const users = await getSimpleUserList()
    if (users && Array.isArray(users)) {
      console.log(`âœ… åˆå§‹åŒ–è·å–ç”¨æˆ·åˆ—è¡¨æˆåŠŸï¼Œå…± ${users.length} ä¸ªç”¨æˆ·`)
      
      // è½¬æ¢ä¸ºå‰ç«¯éœ€è¦çš„æ ¼å¼ï¼Œé™åˆ¶æ˜¾ç¤ºå‰20ä¸ªç”¨æˆ·
      userOptions.value = users.slice(0, 20).map((user: any) => ({
        value: user.id.toString(),
        label: `${user.nickname || user.username} <${user.deptNames ? user.deptNames.join(', ') : ''}>`,
        avatar: user.avatar || '',
        name: user.nickname || user.username,
        email: user.username,
        userId: user.id,
        deptName: user.deptNames ? user.deptNames.join(', ') : ''
      }))
      
      console.log('ğŸ”„ åˆå§‹åŒ–ç”¨æˆ·é€‰é¡¹åˆ—è¡¨:', userOptions.value)
    } else {
      console.warn('âš ï¸ åˆå§‹åŒ–æ—¶APIæ²¡æœ‰è¿”å›æ•°æ®ï¼Œä½¿ç”¨mockæ•°æ®')
      userOptions.value = mockUserOptions
    }
  } catch (error: unknown) {
    console.error('âŒ åˆå§‹åŒ–ç”¨æˆ·åˆ—è¡¨å¤±è´¥:', error)
    console.log('ğŸ“‹ ä½¿ç”¨mockæ•°æ®ä½œä¸ºåˆå§‹é€‰é¡¹')
    userOptions.value = mockUserOptions
  }
})
</script>



<style scoped>
/* æ•´ä½“å¸ƒå±€ */
.mail-container {
  display: flex;
  flex-direction: column;
  height: 100vh;
  background-color: #f5f7fa;
  color: #303133;
  overflow: hidden; /* é˜²æ­¢æº¢å‡ºå‡ºç°æ»šåŠ¨æ¡ */
}

/* ä½¿ç”¨:deepé€‰æ‹©å™¨æ¥æ­£ç¡®åº”ç”¨æŒ‰é’®æ ·å¼ */
.sidebar :deep(.sidebar-top) {
  margin: 0 -8px 20px -8px;
  background: #fff;
  border-radius: 18px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.04);
  padding: 12px 8px 8px 8px;
  border-bottom: 2px solid #e3f2fd;
}

.sidebar :deep(.compose-btn), .sidebar :deep(.inbox-btn) {
  width: 100%;
  padding: 8px 6px;
  margin: 8px 0;
  border: none;
  background-color: transparent;
  cursor: pointer;
  font-size: 16px;
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: 8px;
  color: #0b2a5a;
  font-weight: 800;
}

.sidebar :deep(.sidebar-divider) {
  height: 1px;
  background: #e5e7eb;
  margin: 6px 2px;
}

.sidebar :deep(.compose-btn.active) { color: #0b2a5a; }

.sidebar :deep(.compose-btn:hover), .sidebar :deep(.inbox-btn:hover) { opacity: 0.9; }

.sidebar :deep(.compose-btn.active:hover) {
  background-color: #3367d6;
}

.folder-list {
  flex: 1;
  background: #fff;
  margin: 0 -8px -8px -8px;
  padding: 8px;
  border-radius: 18px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.04);
}

.folder-item {
  display: flex;
  align-items: center;
  padding: 8px 6px;
  cursor: pointer;
  font-size: 14px;
  color: #333;
  border-radius: 12px;
  margin-bottom: 3px;
}

.folder-icon {
  margin-right: 8px;
  font-size: 14px;
  display: flex;
  align-items: center;
}

.folder-name {
  flex: 1;
  font-size: 13px;
}

.folder-badge {
  background-color: #e0e0e0;
  border-radius: 10px;
  padding: 0 6px;
  font-size: 11px;
  color: #666;
  margin-left: 4px;
}

/* é¡¶éƒ¨æ ‡é¢˜æ  */
.mail-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 20px;
  height: 50px;
  border-bottom: 1px solid #e6e6e6;
  background-color: #fff;
  box-shadow: 0 1px 4px rgba(0,0,0,0.05);
}

.mail-logo {
  display: flex;
  align-items: center;
}

.logo-icon {
  width: 30px;
  height: 30px;
  background-color: #4e73df;
  color: white;
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 8px;
}

.logo-text {
  font-size: 18px;
  font-weight: bold;
  color: #4e73df;
}

.search-box {
  width: 240px;
}

/* ä¸»ä½“å¸ƒå±€ */
.content-wrapper {
  display: flex;
  flex: 1;
  background-color: #f5f7f9;
  padding: 0 8px 8px 8px;
  gap: 8px;
}

/* ä¸»å†…å®¹åŒºåŸŸ */
.main-content {
  flex: 1;
  background-color: #fff;
  border-radius: 18px;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.07);
  margin: 0;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* å·¥å…·æ  */
.toolbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 20px;
  height: 66px;
  background-color: #fff;
  border-bottom: 2px solid #e3f2fd;
}

.toolbar-left {
  display: flex;
  gap: 10px;
  align-items: center;
}

.tool-btn {
  height: 33px;
  padding: 0 16px;
  border: 1px solid #e0e0e0;
  border-radius: 12px;
  background-color: #ffffff;
  cursor: pointer;
  font-size: 15px;
  color: #222;
  display: flex;
  align-items: center;
  gap: 6px;
  box-sizing: border-box;
}

.tool-btn:hover {
  background-color: #f0f0f0;
}

.tool-btn.primary {
  background-color: #4285f4;
  color: white;
  border-color: #4285f4;
}

.tool-btn.primary:hover {
  background-color: #3367d6;
}

.tool-btn .el-icon {
  margin-right: 5px;
}

.toolbar-right {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 12px;
  color: #666;
}

.time {
  font-size: 12px;
  color: #666;
  margin-right: 10px;
}

/* é‚®ä»¶è¡¨å• */
.mail-form {
  padding: 10px 15px;
  border-bottom: 1px solid #e0e0e0;
  background-color: #fff;
}

.form-row {
  display: flex;
  align-items: center;
  margin-bottom: 8px;
}

.form-label {
  width: 70px;
  text-align: right;
  padding-right: 10px;
  font-size: 14px;
  color: #606266;
}

.form-field {
  flex: 1;
}

.form-actions {
  margin-left: 10px;
  display: flex;
  gap: 10px;
}

.action-link {
  color: #4e73df;
  cursor: pointer;
  font-size: 14px;
}

.action-link:hover {
  text-decoration: underline;
}

.recipient-select {
  width: 100%;
}

.user-option {
  display: flex;
  align-items: center;
  gap: 8px;
}

/* ç¼–è¾‘å™¨å·¥å…·æ  */
.editor-toolbar {
  padding: 8px 15px;
  border-bottom: 1px solid #e0e0e0;
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  background-color: #f5faff;
  align-items: center;
}

.toolbar-group {
  display: flex;
  align-items: center;
  gap: 2px;
  margin-right: 10px;
  flex-wrap: wrap;
}

.tool-icon {
  min-width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 4px;
  cursor: pointer;
  padding: 0 5px;
  font-size: 12px;
}

.tool-icon:hover {
  background-color: #ecf5ff;
}

.format-btn {
  display: flex;
  align-items: center;
  padding: 0 8px;
  height: 28px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
}

.format-btn:hover {
  background-color: #ecf5ff;
}

.format-btn .el-icon {
  margin-left: 5px;
}

/* ç¼–è¾‘å™¨å†…å®¹åŒº */
.editor-content {
  flex: 1;
  padding: 15px 20px;
  overflow-y: auto;
  min-height: 250px;
  outline: none;
  color: #303133;
  font-size: 14px;
}

/* å‘ä»¶äººä¿¡æ¯ */
.sender-info {
  padding: 10px 15px;
  border-top: 1px solid #e0e0e0;
  font-size: 14px;
  color: #606266;
  background-color: #f8f9fa;
}

.sender-name {
  color: #409eff;
  margin-left: 5px;
  cursor: pointer;
}

/* è”ç³»äººåˆ—è¡¨ */
.contact-list {
  width: 220px;
  background-color: #fff;
  border-left: 1px solid #e0e0e0;
  display: flex;
  flex-direction: column;
  flex-shrink: 0;
  border-radius: 4px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  margin-left: 8px;
  overflow: hidden;
}

.contact-header {
  padding: 12px 15px;
  font-size: 16px;
  font-weight: bold;
  border-bottom: 1px solid #e0e0e0;
  display: flex;
  justify-content: space-between;
  align-items: center;
  color: #4e73df;
  background-color: #f5faff;
}

.contact-search {
  padding: 10px;
  border-bottom: 1px solid #e0e0e0;
}

.contact-groups {
  flex: 1;
  overflow-y: auto;
  height: calc(100vh - 120px); /* è°ƒæ•´é«˜åº¦ä»¥é€‚åº”æ»šåŠ¨ */
}

.contact-group {
  margin-bottom: 2px;
}

.group-header {
  padding: 8px 12px;
  display: flex;
  align-items: center;
  cursor: pointer;
  background-color: #f5f7fa;
  font-size: 14px;
  color: #606266;
  border-radius: 4px;
  margin: 2px 4px;
}

.group-header .el-icon {
  margin-right: 5px;
  font-size: 12px;
  color: #909399;
}

.group-header .count {
  margin-left: 5px;
  font-size: 12px;
  color: #909399;
}

.group-contacts {
  padding: 2px 0;
}

.contact-item {
  padding: 6px 12px 6px 25px;
  display: flex;
  align-items: center;
  cursor: pointer;
  transition: background-color 0.2s;
  border-radius: 4px;
  margin: 2px 4px;
}

.contact-item:hover {
  background-color: #f5f7fa;
}

.contact-item .el-avatar {
  margin-right: 8px;
  background-color: #4e73df;
}

.contact-info {
  display: flex;
  flex-direction: column;
}

.contact-name {
  font-size: 13px;
  color: #303133;
}

.contact-email {
  font-size: 12px;
  color: #909399;
}
</style>
